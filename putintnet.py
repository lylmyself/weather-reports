import os
import base64
import requests
from datetime import datetime
import mimetypes
import json

def upload_to_github_pages():
    # ===== 配置信息 =====
    REPO_OWNER = "lylmyself"
    REPO_NAME = "weather-reports"
    BRANCH = "main"
    GITHUB_TOKEN = os.getenv("GITHUB_TOKEN")
    SOURCE_DIR = r'D:/nowcastyb/nowcastyb_word'
    # ===================
    
    if not GITHUB_TOKEN:
        raise ValueError("未设置 GITHUB_TOKEN 环境变量")
    
    API_URL = f"https://api.github.com/repos/{REPO_OWNER}/{REPO_NAME}"
    HEADERS = {
        "Authorization": f"Bearer {GITHUB_TOKEN}",
        "Accept": "application/vnd.github+json",
        "X-GitHub-Api-Version": "2022-11-28"
    }
    
    try:
        # 1. 获取最新提交SHA
        ref_response = requests.get(
            f"{API_URL}/git/ref/heads/{BRANCH}",
            headers=HEADERS
        )
        ref_response.raise_for_status()
        last_commit_sha = ref_response.json()["object"]["sha"]
        
        # 2. 获取基础树SHA
        commit_response = requests.get(
            f"{API_URL}/git/commits/{last_commit_sha}",
            headers=HEADERS
        )
        commit_response.raise_for_status()
        base_tree_sha = commit_response.json()["tree"]["sha"]
        
        # 3. 准备文件树
        tree_data = []
        print("扫描文件目录:", SOURCE_DIR)
        
        for filename in os.listdir(SOURCE_DIR):
            file_path = os.path.join(SOURCE_DIR, filename)
            
            # 只处理特定类型的文件
            if not os.path.isfile(file_path):
                continue
                
            print(f"处理文件: {filename}")
            
            # 读取文件为二进制
            with open(file_path, "rb") as file:
                content = file.read()
            
            # 对内容进行Base64编码
            encoded_content = base64.b64encode(content).decode("utf-8")
            
            # 获取文件类型
            mime_type, _ = mimetypes.guess_type(file_path)
            file_type = "blob"
            
            # 添加到树数据
            tree_data.append({
                "path": filename,
                "mode": "100644",  # 文件权限
                "type": file_type,
                "content": encoded_content
            })
        
        # 4. 创建新树
        tree_payload = {
            "base_tree": base_tree_sha,
            "tree": tree_data
        }
        
        tree_response = requests.post(
            f"{API_URL}/git/trees",
            headers=HEADERS,
            json=tree_payload
        )
        tree_response.raise_for_status()
        new_tree_sha = tree_response.json()["sha"]
        print(f"创建新树: {new_tree_sha}")
        
        # 5. 创建新提交
        commit_message = f"修复文件上传问题 - {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}"
        commit_payload = {
            "message": commit_message,
            "parents": [last_commit_sha],
            "tree": new_tree_sha
        }
        
        commit_response = requests.post(
            f"{API_URL}/git/commits",
            headers=HEADERS,
            json=commit_payload
        )
        commit_response.raise_for_status()
        new_commit_sha = commit_response.json()["sha"]
        print(f"创建新提交: {new_commit_sha}")
        
        # 6. 更新分支引用
        ref_payload = {
            "sha": new_commit_sha,
            "force": True
        }
        
        ref_response = requests.patch(
            f"{API_URL}/git/refs/heads/{BRANCH}",
            headers=HEADERS,
            json=ref_payload
        )
        ref_response.raise_for_status()
        
        print("="*50)
        print("✅ 文件已成功上传到 GitHub")
        print("请检查仓库中的文件内容是否正常显示")
        print("="*50)
        
        # 7. 验证文件内容
        verify_file_content(API_URL, HEADERS, "map_cref03h.png")
    
    except Exception as e:
        print(f"❌ 上传失败: {str(e)}")
        if hasattr(e, 'response') and e.response:
            try:
                error_details = e.response.json()
                print(f"🔍 错误详情: {error_details.get('message', '无额外信息')}")
                if 'errors' in error_details:
                    for error in error_details['errors']:
                        print(f"- {error.get('message')}")
            except:
                print(f"响应内容: {e.response.text}")

def verify_file_content(api_url, headers, filename):
    """验证文件内容是否正确"""
    print(f"\n🔍 验证文件内容: {filename}")
    
    try:
        # 获取文件内容
        content_response = requests.get(
            f"{api_url}/contents/{filename}",
            headers=headers
        )
        content_response.raise_for_status()
        file_info = content_response.json()
        
        # 检查内容类型
        if "content" not in file_info:
            print("⚠️ 文件内容缺失")
            return
            
        # 检查内容长度
        content = file_info["content"]
        if len(content) < 100:
            print(f"⚠️ 文件内容过短: {len(content)} 字符")
            print("可能仍然是Base64编码文本")
        else:
            print(f"✅ 文件内容长度正常: {len(content)} 字符")
            
        # 检查编码
        if file_info.get("encoding") != "base64":
            print("⚠️ 文件编码不是base64")
        else:
            print("✅ 文件编码正确 (base64)")
            
        # 检查内容是否以图片签名开头
        if filename.lower().endswith(('.png', '.jpg', '.jpeg', '.gif')):
            decoded_content = base64.b64decode(content)
            if decoded_content.startswith(b'\x89PNG\r\n\x1a\n'):
                print("✅ PNG文件签名正确")
            elif decoded_content.startswith(b'\xff\xd8\xff'):
                print("✅ JPEG文件签名正确")
            else:
                print("⚠️ 图片文件签名不正确")
                
    except Exception as e:
        print(f"验证失败: {str(e)}")

if __name__ == "__main__":
    upload_to_github_pages()
